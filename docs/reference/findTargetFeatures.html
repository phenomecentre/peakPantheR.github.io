<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find and integrate target features in each ROI — findTargetFeatures • peakPantheR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Find and integrate target features in each ROI — findTargetFeatures" />
<meta property="og:description" content="For each ROI, fit a curve and integrate the largest feature in
the box. Each entry in ROIsDataPoints must match the corresponding row
in ROI. The curve shape to employ for fitting can be changed with
curveModel while fitting parameters can be changed with params
(list with one param per ROI window). rtMin and rtMax are
established at 0.5
outward (the window is the ROI width); if after 8 iterations rtMin or
rtMax is not found, NA is returned and the peak fit rejected.
peakArea is calculated from rtMin to rtMax. mz is
the weighted (by intensity) average mz of datapoints falling into the
rtMin to rtMax range, mzMin and mzMax are the
minimum and maxmimum mass in these range. If rtMin or rtMax
falls outside of ROI (extracted scans), mzMin or mzMax are
returned as the input ROI limits and mz is an approximation on the
datapoints available (if no scan of the ROI fall between rtMin/rtMax, mz
would be NA, the peak is rejected). If any of the two following ratio are
superior to maxApexResidualRatio, the fit is rejected: 1) ratio of fit
residuals at the apex (predicted apex fit intensity vs measured apex
intensity: fit overshoots the apex), 2) ratio of predicted apex fit intensity
vs maximum measured peak intensity (fit misses the real apex in the peak)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">peakPantheR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/getting-started.html">Getting Started with the peakPantheR package</a>
    </li>
    <li>
      <a href="../articles/parallel-annotation.html">Parallel Annotation</a>
    </li>
    <li>
      <a href="../articles/peakPantheR-GUI.html">peakPantheR Graphical User Interface</a>
    </li>
    <li>
      <a href="../articles/real-time-annotation.html">Real Time Annotation</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/phenomecentre/peakPantheR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find and integrate target features in each ROI</h1>
    <small class="dont-index">Source: <a href='https://github.com/phenomecentre/peakPantheR/blob/master/R/findTargetFeatures.R'><code>R/findTargetFeatures.R</code></a></small>
    <div class="hidden name"><code>findTargetFeatures.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For each ROI, fit a curve and integrate the largest feature in
the box. Each entry in <code>ROIsDataPoints</code> must match the corresponding row
in <code>ROI</code>. The curve shape to employ for fitting can be changed with
<code>curveModel</code> while fitting parameters can be changed with <code>params</code>
(list with one param per ROI window). <code>rtMin</code> and <code>rtMax</code> are
established at 0.5<!-- % of apex intensity using a moving window from the apex -->
outward (the window is the ROI width); if after 8 iterations <code>rtMin</code> or
<code>rtMax</code> is not found, NA is returned and the peak fit rejected.
<code>peakArea</code> is calculated from <code>rtMin</code> to <code>rtMax</code>. <code>mz</code> is
the weighted (by intensity) average mz of datapoints falling into the
<code>rtMin</code> to <code>rtMax</code> range, <code>mzMin</code> and <code>mzMax</code> are the
minimum and maxmimum mass in these range. If <code>rtMin</code> or <code>rtMax</code>
falls outside of ROI (extracted scans), <code>mzMin</code> or <code>mzMax</code> are
returned as the input ROI limits and <code>mz</code> is an approximation on the
datapoints available (if no scan of the ROI fall between rtMin/rtMax, mz
would be NA, the peak is rejected). If any of the two following ratio are
superior to <code>maxApexResidualRatio</code>, the fit is rejected: 1) ratio of fit
residuals at the apex (predicted apex fit intensity vs measured apex
intensity: fit overshoots the apex), 2) ratio of predicted apex fit intensity
vs maximum measured peak intensity (fit misses the real apex in the peak).</p>
    </div>

    <pre class="usage"><span class='fu'>findTargetFeatures</span><span class='op'>(</span>
    <span class='va'>ROIsDataPoints</span>,
    <span class='va'>ROI</span>,
    curveModel <span class='op'>=</span> <span class='st'>"skewedGaussian"</span>,
    params <span class='op'>=</span> <span class='st'>"guess"</span>,
    sampling <span class='op'>=</span> <span class='fl'>250</span>,
    maxApexResidualRatio <span class='op'>=</span> <span class='fl'>0.2</span>,
    verbose <span class='op'>=</span> <span class='cn'>FALSE</span>,
    <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ROIsDataPoints</th>
      <td><p>(list) A list (one entry per ROI window) of data.frame
with signal as row and retention time ('rt'), mass ('mz') and intensity
('int) as columns. Must match each row of ROI.</p></td>
    </tr>
    <tr>
      <th>ROI</th>
      <td><p>(data.frame) A data.frame of compounds to target as rows. Columns:
<code>rtMin</code> (float in seconds), <code>rtMax</code> (float in seconds),
<code>mzMin</code> (float), <code>mzMax</code> (float)</p></td>
    </tr>
    <tr>
      <th>curveModel</th>
      <td><p>(str) Name of the curve model to fit (currently
<code>skewedGaussian</code> and <code>emgGaussian</code>)</p></td>
    </tr>
    <tr>
      <th>params</th>
      <td><p>(list or str) Either 'guess' for automated parametrisation or
list (one per ROI windows) of 'guess' or list of curve fit parameters</p></td>
    </tr>
    <tr>
      <th>sampling</th>
      <td><p>(int) Number of points to employ when subsampling the
fittedCurve (rt, rtMin, rtMax, integral calculation)</p></td>
    </tr>
    <tr>
      <th>maxApexResidualRatio</th>
      <td><p>(float) Ratio of maximum allowed fit residual at
the peak apex, compared to the fit max intensity. (e.g. 0.2 for a maximum
residual of 20% of apex intensity)</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>(bool) If TRUE message the time taken and number of features
found</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Passes arguments to <code>fitCurve</code> to alter peak fitting
(<code>params</code>)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list: <code>list()$peakTable</code> (<em>data.frame</em>) with targeted
features as rows and peak measures as columns (see Details),
<code>list()$curveFit</code> (<em>list</em>) a list of <code>peakPantheR_curveFit</code> or
NA for each ROI.</p>
<h3 class='hasAnchor' id='arguments'><a class='anchor' href='#arguments'></a>Details:</h3>
<p>The returned <code>data.frame</code> is structured as follow:</p><table class='table'>
<tr><td>found</td><td>was the peak found</td></tr>
<tr><td>rt</td><td>retention time of peak apex (sec)</td></tr>
<tr><td>rtMin</td><td>leading edge of peak retention time (sec) determined at 0.5% of
apex intensity</td></tr>
<tr><td>rtMax</td><td>trailing edge of peak retention time (sec) determined at 0.5% of
apex intensity</td></tr>
<tr><td>mz</td><td>weighted (by intensity) mean of peak m/z across scans</td></tr>
<tr><td>mzMin</td><td>m/z peak minimum (between rtMin, rtMax)</td></tr>
<tr><td>mzMax</td><td>m/z peak maximum (between rtMin, rtMax)</td></tr>
<tr><td>peakArea</td><td>integrated peak area</td></tr>
<tr><td>maxIntMeasured</td><td>maximum peak intensity in raw data</td></tr>
<tr><td>maxIntPredicted</td><td>maximum peak intensity based on curve fit (at apex)</td></tr>
</table>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>## Examples cannot be computed as the function is not exported:
## Load data
library(faahKO)
library(MSnbase)
netcdfFilePath &lt;- system.file('cdf/KO/ko15.CDF', package = 'faahKO')
raw_data &lt;- MSnbase::readMSData(netcdfFilePath,centroided=TRUE,mode='onDisk')</p>
<p>## targetFeatTable
targetFeatTable &lt;- data.frame(matrix(vector(), 2, 8, dimnames=list(c(),
                        c('cpdID','cpdName','rtMin','rt','rtMax','mzMin',
                        'mz','mzMax'))), stringsAsFactors=FALSE)
targetFeatTable[1,] &lt;- c('ID-1', 'Cpd 1', 3310., 3344.888, 3390., 522.194778,
                        522.2, 522.205222)
targetFeatTable[2,] &lt;- c('ID-2', 'Cpd 2', 3280., 3385.577, 3440., 496.195038,
                        496.2, 496.204962)
targetFeatTable[,3:8] &lt;- vapply(targetFeatTable[,3:8], as.numeric,
                        FUN.VALUE=numeric(2))</p>
<p>ROIsPt &lt;- extractSignalRawData(raw_data,
                                rt=targetFeatTable[,c('rtMin','rtMax')],
                                mz=targetFeatTable[,c('mzMin','mzMax')],
                                verbose=TRUE)
# Reading data from 2 windows</p>
<p>foundPeaks &lt;- findTargetFeatures(ROIsPt, targetFeatTable, verbose=TRUE)
# Warning: rtMin/rtMax outside of ROI; datapoints cannot be used for
# mzMin/mzMax calculation,
# approximate mz and returning ROI$mzMin and ROI$mzMax for ROI #1
# Found 2/2 features in 0.07 secs</p>
<p>foundPeaks
# $peakTable
#   found    rtMin       rt    rtMax    mzMin    mz    mzMax peakArea
# 1  TRUE 3309.759 3346.828 3385.410 522.1948 522.2 522.2052 26133727
# 2  TRUE 3345.377 3386.529 3428.279 496.2000 496.2 496.2000 35472141
#   maxIntMeasured maxIntPredicted
# 1         889280        901015.8
# 2        1128960       1113576.7
#
# $curveFit
# $curveFit[[1]]
# $amplitude
# [1] 162404.8
# 
# $center
# [1] 3341.888
# 
# $sigma
# [1] 0.07878613
# 
# $gamma
# [1] 0.00183361
# 
# $fitStatus
# [1] 2
# 
# $curveModel
# [1] 'skewedGaussian'
# 
# attr(,'class')
# [1] 'peakPantheR_curveFit'
# 
# $curveFit[[2]]
# $amplitude
# [1] 199249.1
# 
# $center
# [1] 3382.577
# 
# $sigma
# [1] 0.07490442
# 
# $gamma
# [1] 0.00114719
# 
# $fitStatus
# [1] 2
# 
# $curveModel
# [1] 'skewedGaussian'
# 
# attr(,'class')
# [1] 'peakPantheR_curveFit'</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Arnaud Wolfer, Goncalo Correia.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


